<?xml version="1.0" encoding="utf-8"?>
<qroot>
<question>
<Title>qt pixmap.save not working</Title>
<Body>&lt;p&gt;In my screenshot taking project the QPixmap.save() function returns false meaning fails every time. However when I copy the example project from Qt page &lt;a href=&quot;http://qt-project.org/doc/qt-5/qtwidgets-desktop-screenshot-example.html&quot; rel=&quot;nofollow&quot;&gt;http://qt-project.org/doc/qt-5/qtwidgets-desktop-screenshot-example.html&lt;/a&gt;, it works. Thus it rules out Windows 7 issue with file permissions.&lt;/p&gt;&lt;p&gt;So I wonder why it fails? &lt;/p&gt;&lt;p&gt;widget.h file:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;namespace Ui {class Widget;}class Widget : public QWidget{    Q_OBJECTpublic:    explicit Widget(QWidget *parent = 0);    ~Widget();private slots:    void updateTimer();    void startScreenshots();    void stopScreenshots();    void takeScreenshot();private:    Ui::Widget *ui;    QString initialPath;    QPixmap currentScreenshot;    QSpinBox * delaySpinBox;    QPushButton * startButton;    QPushButton * stopButton;    QHBoxLayout * hboxLayout;    QGroupBox * groupBox;    QTimer * timer;    void setInitialPath();    void addStuff();};&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;widget.cpp&lt;/p&gt;&lt;pre&gt;&lt;code&gt;#include &quot;widget.h&quot;#include &quot;ui_widget.h&quot;Widget::Widget(QWidget *parent) :    QWidget(parent),    ui(new Ui::Widget){    ui-&amp;gt;setupUi(this);    setInitialPath();    addStuff();}Widget::~Widget(){    delete ui;}void Widget::updateTimer(){    timer-&amp;gt;stop();    int milisecs = delaySpinBox-&amp;gt;value() *1000;    timer-&amp;gt;start( milisecs );}void Widget::startScreenshots(){    timer-&amp;gt;start( delaySpinBox-&amp;gt;value() * 1000 );}void Widget::stopScreenshots(){    timer-&amp;gt;stop();}void Widget::takeScreenshot(){    //take screenshot    currentScreenshot = QPixmap::grabWindow(QApplication::desktop()-&amp;gt;winId());    //save screenshot    QString format = &quot;png&quot;;    QDateTime local( QDateTime::currentDateTime() );    QString date = local.toString();    QString fileName = initialPath + date;    if(!currentScreenshot.save(fileName, format.toLatin1().constData()) )    {        qDebug() &amp;lt;&amp;lt; &quot;didnt save\n&quot;;        QMessageBox::information(this,&quot;failed to save&quot;,&quot;failed to save&quot;);    }}void Widget::setInitialPath(){    initialPath = QFileDialog::getExistingDirectory(this, tr(&quot;Open Directory&quot;),      &quot;/home&quot;,      QFileDialog::ShowDirsOnly       | QFileDialog::DontResolveSymlinks);}void Widget::addStuff(){  timer = new QTimer(this);  connect(timer,SIGNAL(timeout()),this,SLOT(takeScreenshot()) );  delaySpinBox = new QSpinBox(this);  delaySpinBox-&amp;gt;setValue(60);  delaySpinBox-&amp;gt;setSuffix(tr(&quot; s&quot;));  connect( delaySpinBox,SIGNAL(valueChanged(int)),this,SLOT(updateTimer()) );  startButton = new QPushButton(this);  startButton-&amp;gt;setText(&quot;start&quot;);  connect(startButton,SIGNAL(clicked()),this,SLOT(startScreenshots()) );  stopButton = new QPushButton(this);  stopButton-&amp;gt;setText(&quot;stop&quot;);  connect(stopButton,SIGNAL(clicked()),this,SLOT(stopScreenshots()) );  hboxLayout = new QHBoxLayout(this);  hboxLayout-&amp;gt;addWidget(startButton);  hboxLayout-&amp;gt;addWidget(stopButton);  hboxLayout-&amp;gt;addWidget(delaySpinBox);  groupBox = new QGroupBox(tr(&quot;Options&quot;));  groupBox-&amp;gt;setLayout(hboxLayout);  setLayout(hboxLayout);}&lt;/code&gt;&lt;/pre&gt;</Body>
<Tags>c++,qt,qpixmap</Tags>
</question>
<answer>
<Body>&lt;pre&gt;&lt;code&gt;QDateTime local( QDateTime::currentDateTime() ) &lt;/code&gt;&lt;/pre&gt;&lt;p&gt;probably contains symbols which Windows doesn&#x27;t allow. (there are few symbols). That&#x27;s why you cannot save it.&lt;/p&gt;&lt;p&gt;Solution: fist of all, try to remove dateTime from filename and see is it work.If you want use dateTime try format it without forbidden symbols&lt;/p&gt;&lt;p&gt;Forbidden symbols in Windows for example:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&amp;lt; (less than)&amp;gt; (greater than): (colon)&quot; (double quote)/ (forward slash)\ (backslash)| (vertical bar or pipe)? (question mark)* (asterisk)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;QDateTime always return string which contains colon, but it is forbidden and you can&#x27;t use it, you should replace it.&lt;/p&gt;</Body>
</answer>
<answer>
<Body>&lt;p&gt;It just works under linux. In addition to @Chernobyl&#x27;s answer, AFAIK QPixmap::save doesn&#x27;t add the suffix automatically, so you need to change &lt;/p&gt;&lt;pre&gt;&lt;code&gt;QString fileName = initialPath + date;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;to &lt;/p&gt;&lt;pre&gt;&lt;code&gt;QString fileName = initialPath + date.replace(&quot;:&quot;, &quot;-&quot;) + &quot;.png&quot;;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;(The &lt;code&gt;.replace(&quot;:&quot;, &quot;-&quot;)&lt;/code&gt; part is for escaping forbidden &quot;:&quot; symbol in the file name)&lt;/p&gt;</Body>
</answer>
<answer>
<Body>&lt;p&gt;When you are constructing the filename and its path as follows:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;QString fileName = initialPath + date;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;You will have a path similar to &lt;/p&gt;&lt;blockquote&gt;  &lt;p&gt;C:/Users/YourName/Pictures&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;for your initial path.&lt;/p&gt;&lt;p&gt;While your date will be in the format of &lt;/p&gt;&lt;blockquote&gt;  &lt;p&gt;Sun Sep 7 11:35:46 2014&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;So during your concatenation, you would end up with something like &lt;/p&gt;&lt;blockquote&gt;  &lt;p&gt;C:/Users/YourName/PicturesSun Sep 7 11:35:46 2014&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;If you look closely, there are quite a few problems here:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;You are missing an &quot;/&quot; at the end of your initial path&lt;/li&gt;&lt;li&gt;Your date String contains characters that Windows does not allow for file names&lt;/li&gt;&lt;li&gt;Once saved, the file will be missing its extension, this will need to be added to the end of your filename String as well.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Fixes required:&lt;/p&gt;&lt;p&gt;You need change the date format to something acceptable for Windows by using &lt;/p&gt;&lt;blockquote&gt;  &lt;p&gt;QString date = local.toString(&quot;A Valid QDateTime format here for windows&quot;)&lt;/p&gt;    &lt;p&gt;QString fileName = initialPath + &quot;/&quot; + date + &quot;.&quot; + format;&lt;/p&gt;&lt;/blockquote&gt;</Body>
</answer>
</qroot>
