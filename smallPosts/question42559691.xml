<?xml version="1.0" encoding="utf-8"?>
<qroot>
<question>
<Title>python urllib2 cannot work on some site</Title>
<Body>&lt;pre&gt;&lt;code&gt;    import  urllib2    def download(url,user_agent = &#x27;wswp&#x27;,num_retries=2):        print &#x27;downloading:&#x27;,url        headers = {&#x27;User-Agent&#x27;: &#x27;Mozilla/5.0&#x27;}        request = urllib2.Request(url,headers=headers)        try:            html = urllib2.urlopen(request).read()        except urllib2.URLError as e:            print  &quot;download error:&quot;            html = None            if num_retries&amp;gt;0:                if hasattr(e,&#x27;code&#x27;) and 500&amp;lt;=e.code&amp;lt;600:                    print &quot;e.code = &quot;,e.code                    return download(url,num_retries-1)        return  html    print download(&quot;http://www.huaru.cc/mobile/product/xsim.html&quot;)&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;  &lt;p&gt;the result : C:\Python27\python.exe  E:/py2_7/untitled1/secondClass_Agent downloading:  &lt;a href=&quot;http://www.huaru.cc/mobile/product/xsim.html&quot; rel=&quot;nofollow noreferrer&quot;&gt;http://www.huaru.cc/mobile/product/xsim.html&lt;/a&gt; &lt;/p&gt;    &lt;p&gt;Process finished with exit code 0&lt;/p&gt;&lt;/blockquote&gt;</Body>
<Tags>python,web-crawler,urllib2</Tags>
</question>
<answer>
<Body>&lt;p&gt;In Python, indentation is key.&lt;/p&gt;&lt;pre&gt;&lt;code&gt;import urllib2def download(url,user_agent = &#x27;wswp&#x27;,num_retries=2):    print(&#x27;downloading:&#x27;, url)    headers = {&#x27;User-Agent&#x27;: &#x27;Mozilla/5.0&#x27;}    request = urllib2.Request(url, headers=headers)    try:        html = urllib2.urlopen(request).read()    except urllib2.URLError as e:        print(&quot;download error: {}&quot;.format(e))        html = None        if num_retries &amp;gt; 0:            if hasattr(e, &#x27;code&#x27;) and 500 &amp;lt;= e.code &amp;lt; 600:                print(&quot;e.code = &quot;, e.code)                return download(url, num_retries-1)    return  htmlprint download(&quot;http://www.huaru.cc/mobile/product/xsim.html&quot;)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And it shows like the following:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;(&#x27;downloading:&#x27;, &#x27;http://www.huaru.cc/mobile/product/xsim.html&#x27;)download error: HTTP Error 404: Not FoundNone&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This is because the webpage is return 404.&lt;/p&gt;&lt;p&gt;It&#x27;s tested on Python 2.7.10 and 3.6&lt;/p&gt;&lt;p&gt;Check PEP8: &lt;a href=&quot;https://www.python.org/dev/peps/pep-0008/#id17&quot; rel=&quot;nofollow noreferrer&quot;&gt;https://www.python.org/dev/peps/pep-0008/#id17&lt;/a&gt;&lt;/p&gt;</Body>
</answer>
</qroot>
