<?xml version="1.0" encoding="utf-8"?>
<qroot>
<question>
<Title>How to find and modify specific rows using fields in that row in pandas dataframe?</Title>
<Body>&lt;p&gt;I have this dataset&lt;/p&gt;&lt;pre&gt;&lt;code&gt;time_in     time_out     total_mins8AM         10AM         1206AM         8AM          1206AM         8AM          -231&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;What I am trying to do is get the wrong total_mins values, in this case the one that became negative. I wish to &lt;/p&gt;&lt;ol&gt;&lt;li&gt;identify the records with negative total_mins (Im ok with this)&lt;/li&gt;&lt;li&gt;recompute the timein and timeout difference and overwrite the existing total_mins value&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;I&#x27;m finding a lot of examples on how to use ix to get certain records based on a condition but what I am not sure about is how to use fields from that row, and use them to modify a certain field on a row. so basically, no. 2&lt;/p&gt;&lt;p&gt;only option that I can think of right now is to loop through the records, and perform test and modification but the documentation advises not to do this.&lt;/p&gt;</Body>
<Tags>python,pandas</Tags>
</question>
<answer>
<Body>&lt;p&gt;I think you need difference by &lt;a href=&quot;http://pandas.pydata.org/pandas-docs/stable/generated/pandas.to_datetime.html&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;code&gt;to_datetime&lt;/code&gt;&lt;/a&gt;, get &lt;a href=&quot;http://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.dt.total_seconds.html&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;code&gt;total_seconds&lt;/code&gt;&lt;/a&gt; and divide by &lt;code&gt;60&lt;/code&gt; for minutes.&lt;/p&gt;&lt;p&gt;Then change values by &lt;a href=&quot;http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.loc.html&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;code&gt;loc&lt;/code&gt;&lt;/a&gt; with &lt;code&gt;mask&lt;/code&gt;:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;mask = df[&#x27;total_mins&#x27;] &amp;lt; 0s = (pd.to_datetime(df.loc[mask, &#x27;time_out&#x27;], format=&#x27;%H%p&#x27;) -      pd.to_datetime(df.loc[mask, &#x27;time_in&#x27;], format=&#x27;%H%p&#x27;))       .dt.total_seconds()       .div(60)       .astype(int)print (s)2    120dtype: int32df.loc[mask, &#x27;total_mins&#x27;] = sprint (df)  time_in time_out  total_mins0     8AM     10AM         1201     6AM      8AM         1202     6AM      8AM         120&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Alternative solution with &lt;a href=&quot;http://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.mask.html&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;code&gt;mask&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;df[&#x27;total_mins&#x27;] = df[&#x27;total_mins&#x27;].mask(mask, s)print (df)  time_in time_out  total_mins0     8AM     10AM         1201     6AM      8AM         1202     6AM      8AM         120&lt;/code&gt;&lt;/pre&gt;</Body>
</answer>
<answer>
<Body>&lt;p&gt;Compute the difference of all rows first:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;total_mins_computed = (pd.to_datetime(df.time_out, format=&#x27;%H%p&#x27;) - pd.to_datetime(df.time_in&#x27;, format=&#x27;%H%p&#x27;)).dt.total_seconds()&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If you only want to correct the negative entries, use &lt;code&gt;np.where()&lt;/code&gt;:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;df[&#x27;total_mins&#x27;] = np.where(df.total_mins &amp;gt; 0, df.total_mins, total_mins_computed)&lt;/code&gt;&lt;/pre&gt;</Body>
</answer>
</qroot>
