<?xml version="1.0" encoding="utf-8"?>
<qroot>
<question>
<Title>Pandas Pivot Table- aggfunc to get subtotals on a multi-Index?</Title>
<Body>&lt;p&gt;I have a simple dataframe with an index I need to group on- continent:&lt;/p&gt;&lt;pre&gt;&lt;code&gt; country   continent   value1   value2   value3   uk        eu               1        9        2   us        na               8       39        0   spain     eu               3        9        0   mexico    na               2        7        8   japan     asia             9        9        2   china     asia             2        8        6  &lt;/code&gt;&lt;/pre&gt;&lt;p&gt;All I&#x27;m looking to do is create a dataframe that creates rows for continents and incorporates their subtotals as a value, and then adds Grand total at the end and incorporates the totals for each column. &lt;/p&gt;&lt;pre&gt;&lt;code&gt; Row Labels    Sum of value1   Sum of value2   Sum of value3   asia                     11              17               8   china                     2               8               6   japan                     9               9               2   eu                        4              18               2   spain                     3               9               0   uk                        1               9               2   na                       10              46               8   mexico                    2               7               8   us                        8              39               0   Grand Total              25              81              18  &lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This is my code, and for some reason I can only get the grand total with the aggfunc, not subtotals as well. &lt;/p&gt;&lt;pre&gt;&lt;code&gt;pd.pivot_table(mergedcpt, index=[&#x27;continent&#x27;,&#x27;spread_Bucket&#x27;],aggfunc=np.sum, margins=True)  eu      uk     1    9    2             us        8   39    0    na     spain     3    9    0           mexico    2    7    8    asia   japan     9    9    2           china     2    8    6    all             25   81   18  &lt;/code&gt;&lt;/pre&gt;&lt;p&gt;What am I getting wrong? Appreciate the help- I know previous pandas versions incorporated rows you could aggregate, but I don&#x27;t know how to do this in the new version. Appreciate the help. &lt;/p&gt;</Body>
<Tags>python,pandas,pivot</Tags>
</question>
<answer>
<Body>&lt;p&gt;There is no quick one-liner for what you are trying to do.  You can create a new data frame by grouping on the continents, append the original data frame, and sort the values to get the order you want.&lt;/p&gt;&lt;pre&gt;&lt;code&gt;import pandas as pddf = pd.DataFrame(    {&#x27;continent&#x27;: [&#x27;eu&#x27;, &#x27;na&#x27;, &#x27;eu&#x27;, &#x27;na&#x27;, &#x27;asia&#x27;, &#x27;asia&#x27;],     &#x27;country&#x27;: [&#x27;uk&#x27;, &#x27;us&#x27;, &#x27;spain&#x27;, &#x27;mexico&#x27;, &#x27;japan&#x27;, &#x27;china&#x27;],     &#x27;value1&#x27;: [1, 8, 3, 2, 9, 2],     &#x27;value2&#x27;: [9, 39, 9, 7, 9, 8],     &#x27;value3&#x27;: [2, 0, 0, 8, 2, 6]})g = df.groupby([&#x27;continent&#x27;,&#x27;continent&#x27;]).sum()g.index.set_names(&#x27;Row Label&#x27;, level=-1, inplace=True)gt = pd.DataFrame([g.sum()], columns=g.columns,    index=pd.MultiIndex.from_tuples([(&#x27;~&#x27;,&#x27;Grand Total&#x27;)]))df2 = g.append(gt).reset_index()out = ( df2.append(df.rename(columns={&#x27;country&#x27;: &#x27;Row Label&#x27;})                     .sort_values([&#x27;continent&#x27;, &#x27;Row Label&#x27;]))           .sort_values(&#x27;continent&#x27;)           .drop(&#x27;continent&#x27;, axis=1)           .rename(columns={&#x27;value1&#x27;: &#x27;Sum of value1&#x27;,                            &#x27;value2&#x27;: &#x27;Sum of value2&#x27;,                            &#x27;value3&#x27;: &#x27;Sum of value3&#x27;})           .reset_index(drop=True) )out# returns:     Row Label  Sum of value1  Sum of value2  Sum of value30         asia             11             17              81        china              2              8              62        japan              9              9              23           eu              4             18              24        spain              3              9              05           uk              1              9              26           na             10             46              87       mexico              2              7              88           us              8             39              09  Grand Total             25             81             18&lt;/code&gt;&lt;/pre&gt;</Body>
</answer>
</qroot>
