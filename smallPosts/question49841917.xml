<?xml version="1.0" encoding="utf-8"?>
<qroot>
<question>
<Title>Numpy Implementation of Residual Student for Time Series</Title>
<Body>&lt;p&gt;I&#x27;m trying to write a python function to calculate the studentized residual of a data-set. I tried to follow the traditional equation:&lt;/p&gt;&lt;p&gt;R_student(i) = e(i)/(std(i)*sqrt(1-hi))&lt;/p&gt;&lt;p&gt;where e(i) indicates the residual of the i-th datum, std(i) indicates the estimated value of the standard deviation without the i-th observation, h(i) is the i-th diagonal element in matrix H&lt;/p&gt;&lt;p&gt;X = &lt;/p&gt;&lt;p&gt;| 1 x1|&lt;/p&gt;&lt;p&gt;| 1 x2|&lt;/p&gt;&lt;p&gt;| 1 x3|&lt;/p&gt;&lt;p&gt;| .......|&lt;/p&gt;&lt;p&gt;| 1 xn|&lt;/p&gt;&lt;p&gt;H = X*(X^T * X)^-1 * X^T,&lt;/p&gt;&lt;p&gt;Where X^T is the transpose of matrix X&lt;/p&gt;&lt;p&gt;But the result is completely wrong. I don&#x27;t know what I&#x27;m doing wrong. I have the following input/output data:&lt;/p&gt;&lt;p&gt;data = [26658, 29216, 30035, 30846, 29171, 21068, 28416, 25651, 22122,       26423, 22467, 23274]&lt;/p&gt;&lt;p&gt;I know that the answer must be [-1.3053,  0.1031,  0.6535,  1.2399,  0.7552, -2.6869,  0.9257, 0.0968, -1.0527,  0.8846,  0.4535,  0.1101]&lt;/p&gt;&lt;p&gt;The code that I&#x27;ve wrote so far: &lt;/p&gt;&lt;pre&gt;&lt;code&gt;z = np.ones((len(data), 2))z[:,1] = dataH = np.dot(np.dot(z, inv(np.dot(z.T, z))), z.T)deviations = [data[np.arange(len(data))!=i].std() for i in range(len(data))]  et = np.dot(data, H)S =  (deviations * np.sqrt(1 - np.diagonal(H)))rst = (data-data.mean()) / Srst = np.array(rst)&lt;/code&gt;&lt;/pre&gt;</Body>
<Tags>python,numpy,statistics,outliers</Tags>
</question>
<answer>
<Body>&lt;p&gt;The expression:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;data-data.mean()&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;is not the correct definition of residuals &lt;a href=&quot;https://en.wikipedia.org/wiki/Studentized_residual#How_to_studentize&quot; rel=&quot;nofollow noreferrer&quot;&gt;in this context&lt;/a&gt;. From your matrix &lt;code&gt;H&lt;/code&gt;, you are fitting a linear model of the form &lt;code&gt;y=b0 + b1*x&lt;/code&gt;. The correct meaning of residual is then:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;y - y_hat&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;where &lt;code&gt;y&lt;/code&gt; are the observations of the dependent variable from your data and &lt;/p&gt;&lt;pre&gt;&lt;code&gt;y_hat = np.dot(H,y)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;are fitted values.&lt;/p&gt;</Body>
</answer>
</qroot>
